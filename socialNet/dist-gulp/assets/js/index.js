function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _regenerator(){var y,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",r=e.toStringTag||"@@toStringTag";function n(e,t,r,n){var o,a,i,c,s,u,f,l,p,t=t&&t.prototype instanceof b?t:b,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,a=r,f=n||[],l=!1,p={p:u=0,n:0,v:y,a:d,f:d.bind(y,4),d:function(e,t){return i=e,c=0,s=y,p.n=t,m}},function(e,t,r){if(1<u)throw TypeError("Generator is already running");for(l&&1===t&&d(t,r),c=t,s=r;(v=c<2?y:s)||!l;){i||(c?c<3?(1<c&&(p.n=-1),d(c,s)):p.n=s:p.v=s);try{if(u=2,i){if(v=i[e=c?e:"next"]){if(!(v=v.call(i,s)))throw TypeError("iterator result is not an object");if(!v.done)return v;s=v.value,c<2&&(c=0)}else 1===c&&(v=i.return)&&v.call(i),c<2&&(s=TypeError("The iterator does not provide a '"+e+"' method"),c=1);i=y}else if((v=(l=p.n<0)?s:o.call(a,p))!==m)break}catch(e){i=y,c=1,s=e}finally{u=1}}return{value:v,done:l}}),!0),t;function d(e,t){for(c=e,s=t,v=0;!l&&u&&!r&&v<f.length;v++){var r,n=f[v],o=p.p,a=n[2];3<e?(r=a===t)&&(s=n[(c=n[4])?5:c=3],n[4]=n[5]=y):n[0]<=o&&((r=e<2&&o<n[1])?(c=0,p.v=t,p.n=n[1]):o<a&&(r=e<3||n[0]>t||a<t)&&(n[4]=e,n[5]=t,p.n=a,c=0))}if(r||1<e)return m;throw l=!0,t}}var m={};function b(){}function o(){}function a(){}var v=Object.getPrototypeOf,e=[][t]?v(v([][t]())):(_regeneratorDefine2(v={},t,function(){return this}),v),i=a.prototype=b.prototype=Object.create(e);function c(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,r,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,r,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:c}})()}function _regeneratorDefine2(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,r,n){function o(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))})(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(t,r){var n=c.apply(e,i);function o(e){asyncGeneratorStep(n,t,r,o,a,"next",e)}function a(e){asyncGeneratorStep(n,t,r,o,a,"throw",e)}o(void 0)})}}function api(e){return _api.apply(this,arguments)}function _api(){return(_api=_asyncToGenerator(_regenerator().m(function e(t){var r,n,o=arguments;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=1<o.length&&void 0!==o[1]?o[1]:{},e.n=1,fetch(t,_objectSpread({headers:{"Content-Type":"application/json"},credentials:"same-origin"},n));case 1:if((r=e.v).ok){e.n=3;break}return e.n=2,r.text().catch(function(){return""});case 2:throw n=e.v,new Error("HTTP ".concat(r.status,": ").concat(n));case 3:if((r.headers.get("content-type")||"").includes("application/json"))return e.a(2,r.json());e.n=4;break;case 4:return e.a(2,r.text())}},e)}))).apply(this,arguments)}function initUsersTable(){var e=document.querySelector("#users-table");e&&(e.addEventListener("change",(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var r,n,o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(r=t.target.closest("tr[data-user-id]")){e.n=1;break}return e.a(2);case 1:if(n=r.dataset.userId,t.target.matches("select[data-role]"))return o=t.target.value,e.n=2,api("/api/users/".concat(n,"/role"),{method:"PATCH",body:JSON.stringify({role:o})});e.n=3;break;case 2:showToast("Роль обновлена");case 3:if(t.target.matches("select[data-status]"))return o=t.target.value,e.n=4,api("/api/users/".concat(n,"/status"),{method:"PATCH",body:JSON.stringify({status:o})});e.n=5;break;case 4:showToast("Статус обновлён");case 5:return e.a(2)}},e)}));return function(e){return t.apply(this,arguments)}})()),e.addEventListener("click",(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var r,n,o,a,i;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(a=t.target.closest("button[data-save-user]"))return a=a.closest("tr[data-user-id]"),r=a.dataset.userId,i=a.querySelector('input[name="fullName"]').value.trim(),n=a.querySelector('input[name="email"]').value.trim(),o=a.querySelector('input[name="birthdate"]').value.trim(),a=a.querySelector('input[name="photoUrl"]').value.trim(),i={fullName:i,email:n,birthdate:o,photoUrl:a},e.n=1,api("/api/users/".concat(r),{method:"PUT",body:JSON.stringify(i)});e.n=2;break;case 1:showToast("Пользователь сохранён");case 2:return e.a(2)}},e)}));return function(e){return t.apply(this,arguments)}})()))}function initUserEditForm(){var o=document.querySelector("#user-edit-form");o&&o.addEventListener("submit",(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var r,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t.preventDefault(),r=o.dataset.userId,n=new FormData(o),n=Object.fromEntries(n.entries()),e.n=1,api("/api/users/".concat(r),{method:"PUT",body:JSON.stringify(n)});case 1:showToast("Пользователь сохранён");case 2:return e.a(2)}},e)}));return function(e){return t.apply(this,arguments)}})())}function initFriendsPage(){var n,r=document.querySelector("#friends-list"),o=null==r?void 0:r.dataset.userId;r&&o&&(n=(()=>{var e=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,api("/api/users/".concat(o,"/friends"));case 1:t=e.v,r.innerHTML="",t.forEach(function(e){var t=document.createElement("li");t.className="list-group-item d-flex justify-content-between align-items-center",t.innerHTML="\n        <span>".concat(e.fullName,' <small class="text-muted">&lt;').concat(e.email,'&gt;</small></span>\n        <button class="btn btn-sm btn-outline-danger" data-remove="').concat(e.id,'">Удалить</button>'),r.appendChild(t)});case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}})(),r.addEventListener("click",(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(r=null==(r=t.target.closest("button[data-remove]"))?void 0:r.dataset.remove)return e.n=1,api("/api/users/".concat(o,"/friends/").concat(r),{method:"DELETE"});e.n=3;break;case 1:return e.n=2,n();case 2:showToast("Друг удалён");case 3:return e.a(2)}},e)}));return function(e){return t.apply(this,arguments)}})()),n().catch(console.error))}function initNewsPage(){var r=document.querySelector("#news-list"),n=null==r?void 0:r.dataset.userId;r&&n&&(()=>{var e=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,api("/api/users/".concat(n,"/news"));case 1:t=e.v,r.innerHTML="",t.forEach(function(e){var t=document.createElement("li");t.className="list-group-item",t.innerHTML='<div class="fw-bold">'.concat(new Date(e.createdAt).toLocaleString(),"</div><div>").concat(e.content,"</div>"),r.appendChild(t)});case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}})()().catch(console.error)}function showToast(e){var t=document.createElement("div");t.className="toast align-items-center text-bg-primary border-0 position-fixed bottom-0 end-0 m-3",t.setAttribute("role","alert"),t.innerHTML='<div class="d-flex"><div class="toast-body">'.concat(e,'</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>'),document.body.appendChild(t),new window.bootstrap.Toast(t,{delay:1500}).show(),t.addEventListener("hidden.bs.toast",function(){return t.remove()})}document.addEventListener("DOMContentLoaded",function(){initUsersTable(),initUserEditForm(),initFriendsPage(),initNewsPage()});
//# sourceMappingURL=index.js.map
