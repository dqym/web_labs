/*! For license information please see app.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach(function(e){r(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function r(e,n,r){return(n=function(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function c(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return a(l,"_invoke",function(n,r,o){var a,i,c,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,i=0,c=t,d.n=n,u}};function p(n,r){for(i=n,c=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],p=d.p,v=a[2];n>3?(o=v===r)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=p&&((o=n<2&&p<a[1])?(i=0,d.v=r,d.n=a[1]):p<v&&(o=n<3||a[0]>r||r>v)&&(a[4]=n,a[5]=r,d.n=v,i=0))}if(o||n>1)return u;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),i=l,c=v;(e=i<2?t:c)||!f;){a||(i?i<3?(i>1&&(d.n=-1),p(i,c)):d.n=c:d.v=c);try{if(s=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(f=d.n<0)?c:n.call(r,d))!==u)break}catch(e){a=t,i=1,c=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),l}var u={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var d=[][r]?e(e([][r]())):(a(e={},r,function(){return this}),e),p=f.prototype=s.prototype=Object.create(d);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,a(t,i,"GeneratorFunction")),t.prototype=Object.create(p),t}return l.prototype=f,a(p,"constructor",f),a(f,"constructor",l),l.displayName="GeneratorFunction",a(f,i,"GeneratorFunction"),a(p),a(p,i,"Generator"),a(p,r,function(){return this}),a(p,"toString",function(){return"[object Generator]"}),(o=function(){return{w:c,m:v}})()}function a(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}a=function(t,e,n,r){function i(e,n){a(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},a(t,e,n,r)}function i(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function c(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function c(t){i(a,r,o,c,u,"next",t)}function u(t){i(a,r,o,c,u,"throw",t)}c(void 0)})}}function u(t){return s.apply(this,arguments)}function s(){return s=c(o().m(function t(e){var r,a,i,c=arguments;return o().w(function(t){for(;;)switch(t.n){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:{},t.n=1,fetch(e,n({headers:{"Content-Type":"application/json"},credentials:"same-origin"},r));case 1:if((a=t.v).ok){t.n=3;break}return t.n=2,a.text().catch(function(){return""});case 2:throw i=t.v,new Error("HTTP ".concat(a.status,": ").concat(i));case 3:if(!(a.headers.get("content-type")||"").includes("application/json")){t.n=4;break}return t.a(2,a.json());case 4:return t.a(2,a.text())}},t)})),s.apply(this,arguments)}function l(t){var e=document.createElement("div");e.className="toast align-items-center text-bg-primary border-0 position-fixed bottom-0 end-0 m-3",e.setAttribute("role","alert"),e.innerHTML='<div class="d-flex"><div class="toast-body">'.concat(t,'</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>'),document.body.appendChild(e),new window.bootstrap.Toast(e,{delay:1500}).show(),e.addEventListener("hidden.bs.toast",function(){return e.remove()})}document.addEventListener("DOMContentLoaded",function(){var t,e;(t=document.querySelector("#users-table"))&&(t.addEventListener("change",function(){var t=c(o().m(function t(e){var n,r,a,i;return o().w(function(t){for(;;)switch(t.n){case 0:if(n=e.target.closest("tr[data-user-id]")){t.n=1;break}return t.a(2);case 1:if(r=n.dataset.userId,!e.target.matches("select[data-role]")){t.n=3;break}return a=e.target.value,t.n=2,u("/api/users/".concat(r,"/role"),{method:"PATCH",body:JSON.stringify({role:a})});case 2:l("Роль обновлена");case 3:if(!e.target.matches("select[data-status]")){t.n=5;break}return i=e.target.value,t.n=4,u("/api/users/".concat(r,"/status"),{method:"PATCH",body:JSON.stringify({status:i})});case 4:l("Статус обновлён");case 5:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),t.addEventListener("click",function(){var t=c(o().m(function t(e){var n,r,a,i,c,s,f,d;return o().w(function(t){for(;;)switch(t.n){case 0:if(!(n=e.target.closest("button[data-save-user]"))){t.n=2;break}return r=n.closest("tr[data-user-id]"),a=r.dataset.userId,i=r.querySelector('input[name="fullName"]').value.trim(),c=r.querySelector('input[name="email"]').value.trim(),s=r.querySelector('input[name="birthdate"]').value.trim(),f=r.querySelector('input[name="photoUrl"]').value.trim(),d={fullName:i,email:c,birthdate:s,photoUrl:f},t.n=1,u("/api/users/".concat(a),{method:"PUT",body:JSON.stringify(d)});case 1:l("Пользователь сохранён");case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())),(e=document.querySelector("#user-edit-form"))&&e.addEventListener("submit",function(){var t=c(o().m(function t(n){var r,a,i;return o().w(function(t){for(;;)switch(t.n){case 0:return n.preventDefault(),r=e.dataset.userId,a=new FormData(e),i=Object.fromEntries(a.entries()),t.n=1,u("/api/users/".concat(r),{method:"PUT",body:JSON.stringify(i)});case 1:l("Пользователь сохранён");case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),function(){var t=document.querySelector("#friends-list"),e=null==t?void 0:t.dataset.userId;if(t&&e){var n=function(){var n=c(o().m(function n(){var r;return o().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,u("/api/users/".concat(e,"/friends"));case 1:r=n.v,t.innerHTML="",r.forEach(function(e){var n=document.createElement("li");n.className="list-group-item d-flex justify-content-between align-items-center",n.innerHTML="\n        <span>".concat(e.fullName,' <small class="text-muted">&lt;').concat(e.email,'&gt;</small></span>\n        <button class="btn btn-sm btn-outline-danger" data-remove="').concat(e.id,'">Удалить</button>'),t.appendChild(n)});case 2:return n.a(2)}},n)}));return function(){return n.apply(this,arguments)}}();t.addEventListener("click",function(){var t=c(o().m(function t(r){var a,i;return o().w(function(t){for(;;)switch(t.n){case 0:if(!(i=null===(a=r.target.closest("button[data-remove]"))||void 0===a?void 0:a.dataset.remove)){t.n=3;break}return t.n=1,u("/api/users/".concat(e,"/friends/").concat(i),{method:"DELETE"});case 1:return t.n=2,n();case 2:l("Друг удалён");case 3:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),n().catch(console.error)}}(),function(){var t=document.querySelector("#news-list"),e=null==t?void 0:t.dataset.userId;if(t&&e){var n=function(){var n=c(o().m(function n(){var r;return o().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,u("/api/users/".concat(e,"/news"));case 1:r=n.v,t.innerHTML="",r.forEach(function(e){var n=document.createElement("li");n.className="list-group-item",n.innerHTML='<div class="fw-bold">'.concat(new Date(e.createdAt).toLocaleString(),"</div><div>").concat(e.content,"</div>"),t.appendChild(n)});case 2:return n.a(2)}},n)}));return function(){return n.apply(this,arguments)}}();n().catch(console.error)}}()})})();